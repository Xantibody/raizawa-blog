---
date: 2026-01-19 23:57
title: Rustの勉強[CLI作成編 その3]
category: ぎじゅつ
draft: false
tags:
  - Rust
---

## はじめに

<https://doc.rust-jp.rs/book-ja/>
を読んでいる

- 職場でブログのお披露目会してRustを学んだ
- 実は私のポジションでは触らないのだが、普通におもくて勉強している

### 今日読む場所

https://doc.rust-jp.rs/book-ja/ch12-02-reading-a-file.html#:~:text=%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%82%92%E9%81%A9%E5%BD%93%E3%81%AA%E5%A0%B4%E6%89%80%E3%81%AB%E7%BD%AE%E3%81%84%E3%81%A6%E3%80%81src%2Fmain.rs%E3%82%92%E7%B7%A8%E9%9B%86%E3%81%97%E3%80%81%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E9%96%8B%E3%81%8F%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%97%E3%81%A6%E3%81%8F%E3%81%A0%E3%81%95%E3%81%84%E3%80%82%20%E3%83%AA%E3%82%B9%E3%83%8812-4%E3%81%AB%E7%A4%BA%E3%81%97%E3%81%9F%E3%82%88%E3%81%86%E3%81%AB%E3%81%A7%E3%81%99%E3%81%AD

## お勉強

### メモ

- 粛々とgrepを作っていく
- 引数は受け取れた

- `use std::io::prelude::*;`の書き方してしまってよいのだろうか
- 全部importされてしまうが

```rust
use std::env;
use std::fs::File;
use std::io::prelude::*;

fn main() {
    // --snip--
    println!("In file {}", filename);

    // ファイルが見つかりませんでした
    let mut f = File::open(filename).expect("file not found");

    let mut contents = String::new();
    f.read_to_string(&mut contents)
        // ファイルの読み込み中に問題がありました
        .expect("something went wrong reading the file");

    // テキストは\n{}です
    println!("With text:\n{}", contents);
}
```

- 写経したけど動かなくね、これ
- おいいいいいいいいいいいいいいいいい
- `// snip`が記述あるかもしれないけど表示しないよってことらしい
- しるか！！

```rust
use std::env;
use std::fs::File;
use std::io::prelude::*;

fn main() {
    let args: Vec<String> = env::args().collect();

    let query = &args[1];
    let filename = &args[2];

    // {}を探しています
    println!("Searching for {}", query);

    println!("In file {}", filename);

    let mut f = File::open(filename).expect("file not found");

    let mut contents = String::new();
    let read_to_string = f.read_to_string(&mut contents)
// ファイルの読込中に問題がありました
     .expect("something went wrong reading the file");

 // テキストは\n{}です
    println!("With text:\n{}", contents);
}

```

- とりあえずこうなった

```bash
$ cargo run the poem.txt
   Compiling minigrep v0.1.0 (file:///projects/minigrep)
    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs
     Running `target/debug/minigrep the poem.txt`
Searching for the
In file poem.txt
With text:
I'm nobody! Who are you?
Are you nobody, too?
Then there's a pair of us - don't tell!
They'd banish us, you know.

How dreary to be somebody!
How public, like a frog
To tell your name the livelong day
To an admiring bog!
```

こうでるらしいが

```bash
❯ cargo run the poem.txt
   Compiling minigrep v0.1.0 (/Users/ryu.aizawa/Repo/minigrep)
warning: unused variable: `read_to_string`
  --> src/main.rs:19:9
   |
19 |     let read_to_string = f
   |         ^^^^^^^^^^^^^^ help: if this is intentional, prefix it with an underscore: `_read_to_string`
   |
   = note: `#[warn(unused_variables)]` (part of `#[warn(unused)]`) on by default

warning: `minigrep` (bin "minigrep") generated 1 warning (run `cargo fix --bin "minigrep" -p minigrep` to apply 1 suggestion)
    Finished `dev` profile [unoptimized + debuginfo] target(s) in 0.49s
     Running `target/debug/minigrep the poem.txt`
Searching for the
In file poem.txt
With text:
I'm nobody! Who are you?
Are you nobody, too?
Then there's a pair of us - don't tell!
They'd banish us, you know.

How dreary to be somebody!
How public, like a frog
To tell your name the livelong day
To an admiring bog!

私は誰でもない！あなたは誰？
あなたも誰でもないの？
なら、私たちは組だね、何も言わないで！
あの人たちは、私たちを追放するでしょう。わかりますよね？

誰かでいるなんて侘しいじゃない！
カエルみたいで公すぎるじゃない。
自分の名を長い1日に告げるのなんて。
感服するような沼地にね！
```

- warningがでるようになった
- unused variableってそのまんまだな
- たしかに使っていないかも

あれ、なんかまちがっていたな

```rust
use std::env;
use std::fs::File;
use std::io::prelude::*;

fn main() {
    let args: Vec<String> = env::args().collect();

    let query = &args[1];
    let filename = &args[2];

    // {}を探しています
    println!("Searching for {}", query);

    println!("In file {}", filename);

    let mut f = File::open(filename).expect("file not found");

    let mut contents = String::new();
    f.read_to_string(&mut contents)
        // ファイルの読込中に問題がありました
        .expect("something went wrong reading the file");

    // テキストは\n{}です
    println!("With text:\n{}", contents);
}
```

- こうだ
- 警告も消えた

## まとめ

- 記述間違えていたが、なんか辻褄が合わなくて違うね？と気がつけた
- expactを使っていて、neovim内で戻り値を見るとちゃんとresultになっていて感動した
- 読めるようにもなってきている

https://doc.rust-jp.rs/book-ja/ch12-03-improving-error-handling-and-modularity.html
