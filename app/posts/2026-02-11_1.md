---
date: 2026-02-11 12:06
title: Rustの勉強[Derefトレイト その1]
category: ぎじゅつ
draft: false
tags:
  - Rust
---

## はじめに

<https://doc.rust-jp.rs/book-ja/>
を読んでいる

## お勉強

https://doc.rust-jp.rs/book-ja/ch15-02-deref.html#%E5%8F%82%E7%85%A7%E5%A4%96%E3%81%97%E6%BC%94%E7%AE%97%E5%AD%90%E3%81%A7%E5%80%A4%E3%81%BE%E3%81%A7%E3%83%9D%E3%82%A4%E3%83%B3%E3%82%BF%E3%82%92%E8%BF%BD%E3%81%84%E3%81%8B%E3%81%91%E3%82%8B
をやる

- さすがに眠いが明日休みなのでありがたい
- 今思ったけども自前実装の節は割とあるな
  - traitのおかげ

### メモ

> 数値と数値への参照の比較は許されていません

- 今見直したけどこれもあるのか

> `*y`を使用して参照が指している値まで追いかけなければなりません（そのため参照外しです）

- ここがどうしてもわからんな
- あー`*`が参照外しなんだ
  - この記述やっていない気もするぞ
  - ムカつくねー
  - とりあえずつけると型によって`move`か`copy`されるらしい
  - あー惑わされていた
- 参照外しをしたときはエラーが起きずに`y`と比較したときにエラーが起きると記載されていた
  - 分かりづらすぎてムカつくな

```rust
fn main() {
    let x = 5;
    let y = Box::new(x);

    assert_eq!(5, x);
    assert_eq!(5, *y);
}
```

- そうするとここで`Box`いれる意味は？
  - 参照外しすればいいじゃん
  - そういうことでもないらしい
- でも`Box`でやりたいことって借用と一緒じゃないの？
  - 大枠の役割は似ているけど細かい部分が違うらしい
  - ちょっと抜かそう
  - あ、でも借用だとできない比較は`*`でできるのね

> Derefトレイトがないと、コンパイラは&参照しか参照外しできません。

- 参照も参照外しできたのか
  - まぁ参照だしそうか
  - `Deref`トレイトの話をしていて、実装すると`*`で一度だけ参照を外せるらしい
  - はずしたらなかの型がでてくる

## まとめ

- 大枠でやりたいことは借用と似ている
- ヒープへ置くために入れることができる
- `Deref`トレイトを実装すると参照外しできるようになる
- それっぽく書いたけどわかんねー！
- スマートポインタむず

次ここ
https://doc.rust-jp.rs/book-ja/ch15-02-deref.html#%E9%96%A2%E6%95%B0%E3%82%84%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%81%A7%E6%9A%97%E9%BB%99%E7%9A%84%E3%81%AA%E5%8F%82%E7%85%A7%E5%A4%96%E3%81%97%E5%9E%8B%E5%BC%B7%E5%88%B6
